#!/usr/bin/env roseus
(load "package://hrpsys_ros_bridge_tutorials/euslisp/hrp2w-interface.l")

(ros::roseus-add-msgs "tf2_msgs")

(defun tf-callback (msg)
  (setq *msg* msg)
  ; (format t "In cb~%")
  )
(setq *msg* nil)

(ros::roseus "tutorial_tf")
; (ros::subscribe "/tf" tf2_msgs::TFMessage #'tf-callback)
(setq *tfl* (instance ros::transform-listener :init))
(setq *target-co* (send *tfl* :wait-for-transform "/CHEST_LINK0"
                        "/camera_remote/depth_registered/cluster_decomposeroutput01"
                        (ros::time 0) 1))
(setq *torso-co* (send (car send *hrp2w* :torso)) :copy-worldcoords)
(setq *ik-target* (send *torso-co* :transform *target-co*))
(send *ik-target* :pos)
(setq *rarm-end* (send *hrp2w* :rarm :end-coords :copy-worldcoords))


;; (send *tfl* :lookup-transform
;;       "/camera_link"
;;       (send *msg* :header :frame_id)
;;       (send *msg* :header :stamp)
;; )

(format t "In main~%")
(do-until-key (ros::spin-once))